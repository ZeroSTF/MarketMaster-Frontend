<div class="bg-white rounded-xl shadow-[0px_2px_7px_0px_rgba(33,150,243,0.5)] h-full w-full flex flex-col space-y-4">
  <div
    class="flex-none overflow-hidden px-3 mt-1 bg-white rounded-2xl shadow-[inset_0px_2px_11.4px_rgba(46,156,244,0.25)] p-2">
    <h2 class="text-lg font-semibold text-[#01013D] mb-2 sticky top-0 backdrop-blur-md bg-white/70 z-10 rounded-t-xl">
      Best Winners
    </h2>
    <table class="w-full text-left table-auto">
      <thead class="text-xs text-gray-500">
        <tr>
          <th class="py-2 pr-2 font-normal">Name</th>
          <th class="py-2 px-2 font-normal">Username</th>
          <th class="py-2 px-2 font-normal text-right">Price</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let winner of bestWinners" class="text-sm">
          <td class="py-1 pr-2">
            {{ winner.firstName }} {{ winner.lastName }}
          </td>
          <td class="py-1 px-2">{{ winner.username }}</td>
          <td class="py-1 px-2 text-right">{{ winner.price | currency }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- WatchList Table -->
  <div class="bg-white rounded-lg shadow-md p-3 w-full scrollbar-hide">
    <!-- Header -->
    <h2 class="text-base font-semibold text-[#01013D] mb-3">My Watchlist</h2>

    <!-- Search and Filters Stack -->
    <div class="flex flex-col space-y-2 mb-3">
      <!-- Search -->
      <input type="text" placeholder="Search watchlist..." [value]="searchControl()" (input)="onSearchChange($event)"
        class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:outline-none" />

      <!-- Filters Row -->
      <div class="flex space-x-2">
        <select [value]="sectorControl()" (change)="onSectorChange($event)"
          class="flex-1 px-2 py-1.5 text-sm border border-gray-300 rounded-lg bg-white text-gray-500 focus:ring-1 focus:ring-blue-500 focus:outline-none">
          <option value="all">All Sectors</option>
          <option value="Technology">Technology</option>
          <option value="Healthcare">Healthcare</option>
          <!-- Keep other sectors, just removed for brevity -->
        </select>

        <select [value]="trendControl()" (change)="onTrendChange($event)"
          class="flex-1 px-2 py-1.5 text-sm border border-gray-300 rounded-lg bg-white text-gray-500 focus:ring-1 focus:ring-blue-500 focus:outline-none">
          <option value="all">All Trends</option>
          <option value="up">Up</option>
          <option value="down">Down</option>
        </select>
      </div>
    </div>

    <!-- Table Container -->
    <div class="relative overflow-x-auto scrollbar-hide min-h-96">
      <!-- Loading State -->
      <div *ngIf="isLoading() && !isEmpty()" class="absolute inset-0 bg-white/75 z-10 flex items-center justify-center">
        <img src="images/LogoMM.png" alt="Logo" class="w-full h-12 animate-bounce">
      </div>

      <!-- Empty State -->
      <div *ngIf="isEmpty()" class="text-center py-4">
        <mat-icon class="text-gray-400 text-2xl mb-2">search_off</mat-icon>
        <p class="text-sm text-gray-500">No assets found</p>
      </div>

      <!-- Table -->
      <mat-table [dataSource]="stockDataSource" matSort class="w-full scrollbar-hide" *ngIf="!isLoading()">
        <ng-container *ngFor="let column of columns" [matColumnDef]="column.field" class="scrollbar-hide">
          <mat-header-cell *matHeaderCellDef mat-sort-header
            class="bg-blue-50 text-xs text-blue-900 font-medium py-2  scrollbar-hide">
            {{ column.label }}
          </mat-header-cell>

          <mat-cell *matCellDef="let stock" class="text-xs py-1.5 scrollbar-hide">
            <ng-container [ngSwitch]="column.field">
              <ng-container *ngSwitchCase="'logoUrl'">
                <img [src]="'https://financialmodelingprep.com/image-stock/' + stock.symbol + '.png'"
                  [alt]="stock.symbol" class="w-4 h-4 rounded-full bg-gray-900" loading="lazy"
                  onerror="this.src='images/default.png'">
              </ng-container>

              <span *ngSwitchCase="'currentPrice'">
                {{ stock.currentPrice | currency:'USD':'symbol':'1.2-2' }}
              </span>

              <span *ngSwitchCase="'priceChange'"
                [ngClass]="{'text-green-500': stock.priceChange > 0, 'text-red-500': stock.priceChange < 0}">
                {{ stock.priceChange | number:'1.2-2' }}
              </span>

              <span *ngSwitchDefault>{{ stock[column.field] }}</span>
            </ng-container>
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="stockColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: stockColumns;"></mat-row>
      </mat-table>

      <!-- Paginator -->
      <mat-paginator [pageSizeOptions]="[5, 10]" showFirstLastButtons class="bg-blue-50 text-xs">
      </mat-paginator>
    </div>
  </div>
</div>